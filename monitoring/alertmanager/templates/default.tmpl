{{ define "__subject" }}
[{{ .Status | toUpper }}{{ if eq .Status "firing" }}:{{ .Alerts.Firing | len }}{{ end }}] {{ .GroupLabels.SortedPairs.Values | join " " }} {{ if gt (len .CommonLabels) (len .GroupLabels) }}({{ with .CommonLabels.Remove .GroupLabels.Names }}{{ .Values | join " " }}{{ end }}){{ end }}
{{ end }}

{{ define "__description" }}
{{ if ne .CommonAnnotations.description "" }}
{{ .CommonAnnotations.description }}
{{ else }}
{{ range .Alerts }}
{{ if ne .Annotations.description "" }}{{ .Annotations.description }}{{ end }}
{{ end }}
{{ end }}
{{ end }}

{{ define "__text_alert_list" }}
{{ range . }}
---
Alert: {{ .Annotations.summary }}{{ if .Labels.severity }} ({{ .Labels.severity }}){{ end }}

{{ if ne .Annotations.description "" }}Description: {{ .Annotations.description }}{{ end }}

Labels:
{{ range .Labels.SortedPairs }}  {{ .Name }}: {{ .Value }}
{{ end }}
Annotations:
{{ range .Annotations.SortedPairs }}  {{ .Name }}: {{ .Value }}
{{ end }}
{{ if .GeneratorURL }}Source: {{ .GeneratorURL }}{{ end }}

{{ end }}
{{ end }}

{{ define "email.default.subject" }}{{ template "__subject" . }}{{ end }}

{{ define "email.default.html" }}
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
.alert { border-left: 4px solid #ddd; padding: 10px; margin: 10px 0; }
.critical { border-left-color: #d32f2f; background-color: #ffebee; }
.warning { border-left-color: #f57c00; background-color: #fff3e0; }
.resolved { border-left-color: #388e3c; background-color: #e8f5e8; }
.labels { background-color: #f5f5f5; padding: 8px; margin: 8px 0; border-radius: 4px; }
.timestamp { color: #666; font-size: 0.9em; }
</style>
</head>
<body>
<h2>Digital Command Center Alerts</h2>

{{ if gt (len .Alerts.Firing) 0 }}
<h3>ðŸš¨ Firing Alerts ({{ .Alerts.Firing | len }})</h3>
{{ range .Alerts.Firing }}
<div class="alert {{ .Labels.severity }}">
  <h4>{{ .Annotations.summary }}</h4>
  {{ if .Annotations.description }}<p>{{ .Annotations.description }}</p>{{ end }}
  
  <div class="labels">
    <strong>Labels:</strong><br>
    {{ range .Labels.SortedPairs }}
    <span>{{ .Name }}: {{ .Value }}</span><br>
    {{ end }}
  </div>
  
  <div class="timestamp">
    Started: {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}
  </div>
  
  {{ if .GeneratorURL }}
  <p><a href="{{ .GeneratorURL }}">View in Prometheus</a></p>
  {{ end }}
</div>
{{ end }}
{{ end }}

{{ if gt (len .Alerts.Resolved) 0 }}
<h3>âœ… Resolved Alerts ({{ .Alerts.Resolved | len }})</h3>
{{ range .Alerts.Resolved }}
<div class="alert resolved">
  <h4>{{ .Annotations.summary }}</h4>
  {{ if .Annotations.description }}<p>{{ .Annotations.description }}</p>{{ end }}
  
  <div class="timestamp">
    Resolved: {{ .EndsAt.Format "2006-01-02 15:04:05 UTC" }}
    Duration: {{ .EndsAt.Sub .StartsAt }}
  </div>
</div>
{{ end }}
{{ end }}

<hr>
<p><small>This alert was generated by the Digital Command Center monitoring system.</small></p>
</body>
</html>
{{ end }}

{{ define "slack.default.title" }}
{{ if eq .Status "firing" }}ðŸš¨{{ else }}âœ…{{ end }} {{ .GroupLabels.alertname }} - {{ .Status | title }}
{{ end }}

{{ define "slack.default.text" }}
{{ range .Alerts }}
*Alert:* {{ .Annotations.summary }}
*Description:* {{ .Annotations.description }}
*Severity:* {{ .Labels.severity }}
*Service:* {{ .Labels.service }}
*Instance:* {{ .Labels.instance }}
{{ if .GeneratorURL }}*Source:* <{{ .GeneratorURL }}|View in Prometheus>{{ end }}
{{ end }}
{{ end }}